<!DOCTYPE html>
<html lang="fr" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO & BRANDING -->
    <title>Arsenal101 | L'Arsenal Digital Pro (Gemini AI Edition)</title>
    <meta name="description" content="Le hub ultime regroupant plus de 300 outils IA, Finance et Sport, maintenant propuls√© par Gemini 2.5.">
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>‚ö°Ô∏è</text></svg>">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');
        
        :root { 
            --ia: 168, 85, 247; --fi: 16, 185, 129; --sp: 244, 63, 94; --bg: 2, 6, 23; --accent: 168, 85, 247;
        }

        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background-color: rgb(var(--bg)); 
            color: #f1f5f9; 
            overflow-x: hidden;
        }

        /* Animations */
        @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-10px); } }
        .float-animation { animation: float 3s ease-in-out infinite; }

        .section-bg {
            position: absolute; inset: 0; z-index: 0;
            background-size: cover; background-position: center; background-attachment: fixed;
            opacity: 0.12; mix-blend-mode: luminosity;
            mask-image: linear-gradient(to bottom, black 0%, transparent 100%);
        }
        #view-ia .section-bg { background-image: url('https://images.unsplash.com/photo-1620712943543-bcc4688e7485?q=80&w=1500'); }
        #view-finance .section-bg { background-image: url('https://images.unsplash.com/photo-1642543492481-44e81e3914a7?q=80&w=1500'); }
        #view-sport .section-bg { background-image: url('https://images.unsplash.com/photo-1517649763962-0c623066013b?q=80&w=1500'); }

        .page-view { display: none; min-height: 100vh; width: 100%; position: relative; padding-bottom: 5rem; }
        .page-view.active { display: block; animation: fadeIn 0.6s ease-out; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }

        .split-wrapper { display: flex; height: 100vh; width: 100%; overflow: hidden; background: #000; }
        .split-pane { 
            position: relative; width: 33.33%; height: 100%; transition: all 0.8s cubic-bezier(0.16, 1, 0.3, 1); 
            display: flex; align-items: center; justify-content: center; cursor: pointer;
            border-right: 1px solid rgba(255, 255, 255, 0.05);
        }
        @media (min-width: 1024px) {
            .split-pane:hover { width: 45%; }
            .split-wrapper:hover .split-pane:not(:hover) { width: 27.5%; filter: brightness(0.4) blur(4px); }
        }
        
        .pane-bg { transition: transform 10s ease; }
        .split-pane:hover .pane-bg { transform: scale(1.15); }

        .glass { background: rgba(2, 6, 23, 0.7); backdrop-filter: blur(25px); border: 1px solid rgba(255, 255, 255, 0.08); }
        
        .tool-card { 
            background: rgba(255, 255, 255, 0.03); 
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }
        .tool-card:hover { 
            background: rgba(255, 255, 255, 0.08); 
            transform: translateY(-5px); 
            border-color: rgba(var(--accent), 0.5);
            box-shadow: 0 15px 35px -5px rgba(0, 0, 0, 0.5);
        }

        .category-badge {
            font-size: 0.6rem; font-weight: 800; padding: 2px 8px; border-radius: 20px; text-transform: uppercase; letter-spacing: 0.05em;
        }

        .news-ticker-item { padding: 1rem; border-bottom: 1px solid rgba(255,255,255,0.05); transition: background 0.2s; }

        input, textarea, select { background: rgba(0,0,0,0.4); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 14px; color: white; outline: none; transition: border 0.3s; width: 100%; }
        input:focus, textarea:focus, select:focus { border-color: rgba(var(--accent), 0.5); }

        .gemini-gradient {
            background: linear-gradient(135deg, #4b90ff 0%, #ff4b91 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        @media (max-width: 1023px) { 
            .split-wrapper { flex-direction: column; } 
            .split-pane { width: 100% !important; height: 33.33% !important; } 
        }

        /* Bento Article Style */
        .article-bento {
            background: linear-gradient(135deg, rgba(var(--accent), 0.1) 0%, rgba(2, 6, 23, 0.6) 100%);
            border: 1px solid rgba(var(--accent), 0.2);
        }
    </style>
</head>
<body class="selection:bg-white/20">

    <!-- Modale Article -->
    <div id="aiModal" class="fixed inset-0 bg-black/95 z-[110] hidden flex items-center justify-center p-0 sm:p-4">
        <div class="glass w-full max-w-4xl h-full sm:h-[90vh] sm:rounded-[2.5rem] overflow-hidden relative border border-white/10 flex flex-col bg-[#0b0c15]">
            <button onclick="window.toggleModal('aiModal')" class="absolute top-6 right-6 w-12 h-12 flex items-center justify-center rounded-full bg-black/40 backdrop-blur-md z-20 text-white">‚úï</button>
            <div id="articleImageHeader" class="h-64 md:h-80 w-full overflow-hidden shrink-0 relative">
                <div class="absolute inset-0 bg-gradient-to-t from-[#0b0c15] to-transparent z-10"></div>
                <img id="modalCoverImage" src="" alt="Couverture" class="w-full h-full object-cover">
            </div>
            <div class="flex-1 overflow-y-auto p-8 md:p-16">
                <div id="aiContent" class="prose prose-invert prose-xl max-w-none text-slate-200"></div>
            </div>
        </div>
    </div>

    <!-- VUE ACCUEIL -->
    <section id="view-home" class="page-view active">
        <div class="split-wrapper">
            <div onclick="window.switchView('ia')" class="split-pane group">
                <div class="pane-bg absolute inset-0 opacity-40 bg-center bg-cover" style="background-image: url('https://images.unsplash.com/photo-1677442136019-21780ecad995?q=80&w=1200');"></div>
                <div class="pane-content text-center relative z-10 p-6">
                    <div class="text-6xl mb-4 float-animation">ü§ñ</div>
                    <h1 class="text-6xl md:text-8xl font-black text-white tracking-tighter">101<span class="text-purple-500">IA</span></h1>
                    <p class="text-[10px] tracking-[0.4em] font-black opacity-60 uppercase mt-4">Automate, Generate, Master</p>
                </div>
            </div>
            <div onclick="window.switchView('finance')" class="split-pane group">
                <div class="pane-bg absolute inset-0 opacity-40 bg-center bg-cover" style="background-image: url('https://images.unsplash.com/photo-1590283603385-17ffb3a7f29f?q=80&w=1200');"></div>
                <div class="pane-content text-center relative z-10 p-6">
                    <div class="text-6xl mb-4 float-animation">üí∞</div>
                    <h1 class="text-6xl md:text-8xl font-black text-white tracking-tighter">101<span class="text-emerald-500">FI</span></h1>
                    <p class="text-[10px] tracking-[0.4em] font-black opacity-60 uppercase mt-4">Analyze, Invest, Compound</p>
                </div>
            </div>
            <div onclick="window.switchView('sport')" class="split-pane group border-r-0">
                <div class="pane-bg absolute inset-0 opacity-40 bg-center bg-cover" style="background-image: url('https://images.unsplash.com/photo-1541534741688-6078c6bfb5c5?q=80&w=1200');"></div>
                <div class="pane-content text-center relative z-10 p-6">
                    <div class="text-6xl mb-4 float-animation">üèÉ</div>
                    <h1 class="text-6xl md:text-8xl font-black text-white tracking-tighter">101<span class="text-rose-600">SP</span></h1>
                    <p class="text-[10px] tracking-[0.4em] font-black opacity-60 uppercase mt-4">Train, Perform, Recover</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Navigation Globale -->
    <nav id="main-nav" class="fixed top-6 left-1/2 -translate-x-1/2 w-[92%] max-w-6xl z-50 hidden">
        <div class="glass rounded-full px-8 py-3 flex justify-between items-center bg-[#020617]/80">
            <button onclick="window.switchView('home')" class="text-xs font-black opacity-60 hover:opacity-100 transition-opacity uppercase tracking-widest">‚Üê HUB ARSENAL101</button>
            <div class="text-xl font-black tracking-tighter uppercase">Arsenal 101</div>
            <div class="flex items-center gap-4">
                <span id="live-time" class="hidden md:block text-[10px] font-mono opacity-40 uppercase tracking-widest">00:00:00</span>
                <div class="flex items-center gap-2 px-3 py-1 rounded-full bg-white/5 border border-white/10">
                    <div class="w-2 h-2 rounded-full bg-blue-500 shadow-[0_0_10px_#3b82f6]"></div>
                    <span class="text-[9px] font-bold uppercase tracking-wider">Gemini Intel Active ‚ú®</span>
                </div>
            </div>
        </div>
    </nav>

    <!-- SECTION IA -->
    <section id="view-ia" class="page-view pt-28">
        <div class="section-bg"></div>
        <div class="container mx-auto px-4 max-w-7xl relative z-10 space-y-12">
            
            <div class="grid lg:grid-cols-4 gap-8">
                <div class="lg:col-span-3 space-y-12">
                    <div class="glass rounded-[2.5rem] p-10 border-l-4 border-purple-500 bg-gradient-to-r from-purple-900/20 to-transparent">
                        <div class="flex items-center gap-6 mb-4">
                            <div class="text-5xl">ü§ñ</div>
                            <h2 class="text-4xl md:text-5xl font-black tracking-tighter leading-tight">Moteur IA <span class="text-purple-400">& Automatisation</span></h2>
                        </div>
                        <p class="opacity-60 max-w-3xl">L'Arsenal le plus complet : 120+ outils pour la g√©n√©ration et l'optimisation par intelligence artificielle. Explorez le futur de la productivit√©.</p>
                    </div>

                    <!-- Bloc Articles Automatiques -->
                    <div class="space-y-6">
                        <h3 class="text-xl font-black uppercase tracking-widest text-purple-400">Analyses IA de 101Journaliste</h3>
                        <div id="ia-articles-grid" class="grid md:grid-cols-2 gap-6">
                            <!-- Les articles charg√©s depuis Firestore s'afficheront ici -->
                        </div>
                    </div>

                    <div id="ia-tools-grid" class="grid sm:grid-cols-2 xl:grid-cols-3 gap-6"></div>
                </div>

                <div class="lg:col-span-1 space-y-8">
                    <div class="glass p-8 rounded-[2rem] border-t-2 border-purple-500">
                        <h3 class="font-black text-xl mb-4">L'Alchimiste <span class="text-purple-400">Gemini</span></h3>
                        <textarea id="promptInputIA" rows="3" placeholder="Script, code ou id√©e brute..." class="text-sm mb-4"></textarea>
                        <button onclick="window.callGemini('ia-main')" class="w-full py-4 bg-purple-600 text-white font-bold rounded-xl active:scale-95 transition-all">‚ú® Sublimer via Gemini</button>
                        <div id="outputIA" class="mt-6 hidden p-4 bg-white/5 rounded-xl border border-white/10 text-xs font-mono max-h-[400px] overflow-y-auto"></div>
                    </div>
                    <div class="glass rounded-[2rem] p-6">
                        <h3 class="font-black text-[10px] uppercase tracking-widest mb-4 opacity-50">Flux Tech Temps R√©el</h3>
                        <div id="ia-google-feed" class="space-y-1 text-sm min-h-[160px]"></div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- SECTION FINANCE -->
    <section id="view-finance" class="page-view pt-28">
        <div class="section-bg"></div>
        <div class="container mx-auto px-4 max-w-7xl relative z-10 space-y-12">
            
            <div class="grid lg:grid-cols-3 gap-6">
                <!-- Tableau de Bord Bourse -->
                <div class="lg:col-span-2 glass rounded-[2.5rem] p-8 border-l-4 border-emerald-500">
                    <div class="flex justify-between items-start mb-8">
                        <div>
                            <h2 class="text-3xl font-black tracking-tighter">Bourse en <span class="text-emerald-400">Direct</span></h2>
                            <p class="text-xs text-slate-400">Indicateurs de march√©s & tendances mondiales</p>
                        </div>
                        <div class="flex flex-col items-end gap-2">
                            <span class="px-3 py-1 bg-white/5 rounded-full text-[10px] font-bold">BTC/EUR <span id="ticker-btc">--</span></span>
                        </div>
                    </div>
                    
                    <div class="grid md:grid-cols-3 gap-4 h-[180px]">
                        <div class="glass rounded-2xl p-4">
                            <span class="text-[10px] font-bold opacity-40 uppercase">Bitcoin</span>
                            <canvas id="btcChartMini"></canvas>
                        </div>
                        <div class="glass rounded-2xl p-4">
                            <span class="text-[10px] font-bold opacity-40 uppercase">Ethereum</span>
                            <canvas id="ethChartMini"></canvas>
                        </div>
                        <div class="glass rounded-2xl p-4">
                            <span class="text-[10px] font-bold opacity-40 uppercase">Solana</span>
                            <canvas id="solChartMini"></canvas>
                        </div>
                    </div>
                </div>

                <div class="glass rounded-[2.5rem] p-8 border-t-2 border-emerald-500">
                    <h3 class="text-xl font-bold mb-6">üßÆ Oracle Oracle</h3>
                    <div class="space-y-4">
                        <textarea id="financeInputGemini" rows="2" placeholder="Question sur votre portefeuille..." class="text-xs"></textarea>
                        <button onclick="window.callGemini('finance-oracle')" class="w-full py-3 bg-emerald-600 text-white font-bold rounded-xl text-xs">‚ú® Analyser Allocation</button>
                        <div id="outputFinance" class="hidden p-4 bg-white/5 rounded-xl border border-white/10 text-[10px] font-mono max-h-[150px] overflow-y-auto"></div>
                        <div id="conv-result" class="mt-4 text-center text-xl font-black text-emerald-400">-- ‚Ç¨</div>
                    </div>
                </div>
            </div>

            <!-- Bloc Articles Finance -->
            <div class="space-y-6">
                <h3 class="text-xl font-black uppercase tracking-widest text-emerald-400">Analyses March√©s de 101Fi</h3>
                <div id="fi-articles-grid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
            </div>

            <div id="fi-tools-grid" class="grid sm:grid-cols-2 lg:grid-cols-4 gap-6"></div>
        </div>
    </section>

    <!-- SECTION SPORT -->
    <section id="view-sport" class="page-view pt-28">
        <div class="section-bg"></div>
        <div class="container mx-auto px-4 max-w-7xl relative z-10 space-y-12">
            <div class="glass rounded-[2.5rem] p-10 border-l-4 border-rose-500 bg-gradient-to-r from-rose-900/20 to-transparent">
                <h2 class="text-4xl md:text-5xl font-black tracking-tighter leading-tight">Sport & <span class="text-rose-400">Optimisation</span></h2>
            </div>

            <!-- Bloc Articles Sport -->
            <div class="space-y-6">
                <h3 class="text-xl font-black uppercase tracking-widest text-rose-400">Chroniques Performance de 101Sport</h3>
                <div id="sp-articles-grid" class="grid md:grid-cols-2 lg:grid-cols-4 gap-6"></div>
            </div>

            <div class="grid lg:grid-cols-4 gap-8">
                <div class="lg:col-span-1 space-y-8">
                    <div class="glass p-8 rounded-[2rem] border-t-2 border-rose-500">
                        <h3 class="font-black text-xl mb-4">Le Protocole <span class="text-rose-400">Sport</span></h3>
                        <textarea id="sportInputGemini" rows="3" placeholder="Objectif, temps disponible..." class="text-sm mb-4"></textarea>
                        <button onclick="window.callGemini('sport-coach')" class="w-full py-4 bg-rose-600 text-white font-bold rounded-xl active:scale-95 transition-all">‚ú® G√©n√©rer Protocole IA</button>
                        <div id="outputSport" class="mt-6 hidden p-4 bg-white/5 rounded-xl border border-white/10 text-xs font-mono max-h-[300px] overflow-y-auto"></div>
                    </div>
                    <div id="sport-google-feed" class="glass rounded-[2rem] p-6 space-y-1 text-sm min-h-[160px]"></div>
                </div>
                <div class="lg:col-span-3">
                    <div id="sp-tools-grid" class="grid sm:grid-cols-2 xl:grid-cols-3 gap-6"></div>
                </div>
            </div>
        </div>
    </section>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
        import { getFirestore, collection, onSnapshot, query, limit, orderBy } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

        const firebaseConfig = {
          apiKey: "AIzaSyCYsw6YtHbloD4tSJO4-4t1G8TAditUezE",
          authDomain: "arsenal101-f64ab.firebaseapp.com",
          projectId: "arsenal101-f64ab",
          storageBucket: "arsenal101-f64ab.firebasestorage.app",
          messagingSenderId: "148334934082",
          appId: "1:148334934082:web:94ea6e6b38d2a01cfc15db",
          measurementId: "G-Q4C2PHQCGE"
        };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const currentAppId = "arsenal101-f64ab";

        let marketData = {};
        const charts = {};

        // --- GEMINI CONFIG ---
        const geminiApiKey = ""; // Cl√© runtime
        const GEMINI_MODEL = "gemini-2.5-flash-preview-09-2025";

        async function fetchGemini(prompt, systemPrompt = "") {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/${GEMINI_MODEL}:generateContent?key=${geminiApiKey}`;
            const payload = {
                contents: [{ parts: [{ text: prompt }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] }
            };
            const response = await fetch(url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
            const result = await response.json();
            return result.candidates?.[0]?.content?.parts?.[0]?.text || "Erreur de g√©n√©ration.";
        }

        window.callGemini = async (context) => {
            const configs = {
                'ia-main': { input: 'promptInputIA', out: 'outputIA', sys: "Tu es l'expert Arsenal IA." },
                'finance-oracle': { input: 'financeInputGemini', out: 'outputFinance', sys: "Tu es l'Oracle d'Arsenal Finance." },
                'sport-coach': { input: 'sportInputGemini', out: 'outputSport', sys: "Tu es le coach Arsenal Sport." }
            };
            const config = configs[context];
            const prompt = document.getElementById(config.input).value;
            if(!prompt) return;
            const out = document.getElementById(config.out);
            out.classList.remove('hidden');
            out.innerHTML = "<span class='animate-pulse italic'>Gemini traite la requ√™te...</span>";
            try {
                const text = await fetchGemini(prompt, config.sys);
                out.innerHTML = marked.parse(text);
            } catch(e) { out.innerHTML = "Erreur Gemini."; }
        };

        // --- DATA TOOLS ---
        const arsenalIA = [
            { name: "Canva Pro", hook: "Le design d√©mocratis√©.", intro: "Cr√©ez des visuels √©poustouflants pour vos r√©seaux et miniatures en quelques clics.", tag: "TOP", icon: "fa-palette", link: "https://canva.com" },
            { name: "ElevenLabs", hook: "La voix de l'IA.", intro: "Transformez n'importe quel texte en une voix off humaine ultra-r√©aliste en 29 langues.", tag: "PRO", icon: "fa-microphone", link: "https://elevenlabs.io" },
            { name: "Runway Gen-3", hook: "Le cin√©ma dans votre navigateur.", intro: "G√©n√©rez des vid√©os cin√©matographiques √† partir de simples prompts textuels.", tag: "VIDEO", icon: "fa-video", link: "https://runwayml.com" },
            { name: "Claude 3.5 Sonnet", hook: "L'IA qui raisonne mieux.", intro: "Analyse de code, r√©daction complexe et raisonnement logique de haut niveau.", tag: "CODE", icon: "fa-code", link: "https://claude.ai" },
            { name: "Midjourney v6", hook: "L'art sans pinceau.", intro: "L'outil de g√©n√©ration d'images le plus puissant pour des r√©sultats photor√©alistes.", tag: "ART", icon: "fa-wand-magic-sparkles", link: "https://midjourney.com" },
            { name: "Perplexity AI", hook: "La recherche r√©invent√©e.", intro: "Un moteur de r√©ponse qui cite ses sources et remplace avantageusement Google.", tag: "SEARCH", icon: "fa-magnifying-glass", link: "https://perplexity.ai" },
            { name: "Leonardo.ai", hook: "Lib√©rez votre cr√©ativit√©.", intro: "Plateforme compl√®te pour g√©n√©rer et √©diter des images avec des mod√®les sp√©cialis√©s.", tag: "IMAGE", icon: "fa-image", link: "https://leonardo.ai" },
            { name: "Zapier", hook: "Automatisez tout.", intro: "Connectez vos outils IA entre eux pour cr√©er des workflows 100% autonomes.", tag: "AUTO", icon: "fa-bolt", link: "https://zapier.com" }
        ];

        const arsenalFI = [
            { name: "TradingView", hook: "L'≈ìil du march√©.", intro: "La r√©f√©rence mondiale pour l'analyse technique et le suivi des actifs en temps r√©el.", tag: "TOP", icon: "fa-chart-line", link: "https://tradingview.com" },
            { name: "DexScreener", hook: "Chassez les p√©pites.", intro: "Analysez les nouveaux tokens sur les exchanges d√©centralis√©s avant tout le monde.", tag: "DEX", icon: "fa-search-dollar", link: "https://dexscreener.com" },
            { name: "Arkham Intel", hook: "Espionnage On-chain.", intro: "Visualisez les portefeuilles des baleines et les mouvements de fonds sur la blockchain.", tag: "DATA", icon: "fa-fingerprint", link: "https://arkhamintelligence.com" },
            { name: "CoinMarketCap", hook: "Le guide du capital.", intro: "Classements, capitalisations et actualit√©s de plus de 10 000 cryptomonnaies.", tag: "FREE", icon: "fa-coins", link: "https://coinmarketcap.com" },
            { name: "Finary", hook: "Votre patrimoine 360¬∞.", intro: "Suivez vos investissements bourse, crypto et immo sur un seul dashboard moderne.", tag: "PATRIMOINE", icon: "fa-vault", link: "https://finary.com" },
            { name: "Boursorama", hook: "La banque du trader.", icon: "fa-building-columns", tag: "BANQUE", intro: "Plateforme leader en France pour investir en bourse et sur le CAC 40.", link: "https://boursorama.com" }
        ];

        const arsenalSP = [
            { name: "Strava", hook: "D√©passez vos limites.", intro: "Le r√©seau social incontournable pour enregistrer et partager vos performances sportives.", tag: "TOP", icon: "fa-route", link: "https://strava.com" },
            { name: "WHOOP", hook: "Mesurez l'invisible.", intro: "Analyse ultra-pr√©cise de votre r√©cup√©ration, de votre sommeil et de votre effort quotidien.", tag: "IA", icon: "fa-heart-pulse", link: "https://whoop.com" },
            { name: "Fitbod", hook: "Coach de poche.", intro: "G√©n√®re des programmes de musculation personnalis√©s bas√©s sur vos s√©ances pr√©c√©dentes.", tag: "TRAINING", icon: "fa-dumbbell", link: "https://fitbod.me" },
            { name: "MyNetDiary", hook: "Nutrition parfaite.", intro: "Le tracker de calories le plus simple et complet pour atteindre vos objectifs de poids.", tag: "DIET", icon: "fa-apple-whole", link: "https://mynetdiary.com" },
            { name: "TrainingPeaks", hook: "Planification d'√©lite.", intro: "L'outil utilis√© par les pros pour planifier des entra√Ænements d'endurance de haut niveau.", tag: "PRO", icon: "fa-mountain", link: "https://trainingpeaks.com" }
        ];

        function renderGrid(id, list, color) {
            const container = document.getElementById(id);
            if(!container) return;
            container.innerHTML = list.map(t => `
                <div class="tool-card rounded-2xl p-6 flex flex-col justify-between group cursor-pointer" onclick="window.open('${t.link}', '_blank')">
                    <div>
                        <div class="flex justify-between items-start mb-4">
                            <div class="w-10 h-10 rounded-xl bg-${color}-600/10 flex items-center justify-center">
                                <i class="fas ${t.icon} text-xl text-${color}-400"></i>
                            </div>
                            <span class="category-badge bg-${color}-600/20 text-${color}-400">${t.tag}</span>
                        </div>
                        <h4 class="font-bold text-white text-lg mb-1">${t.name}</h4>
                        <p class="text-xs text-${color}-400 font-bold mb-3 italic">"${t.hook}"</p>
                        <p class="text-[11px] text-slate-500 leading-relaxed">${t.intro}</p>
                    </div>
                    <div class="mt-4 text-[10px] font-bold uppercase tracking-widest text-slate-400 group-hover:text-${color}-400 transition-colors">Explorer ‚Üó</div>
                </div>
            `).join('');
        }

        function loadArticles(col, gridId, color) {
            const container = document.getElementById(gridId);
            if(!container) return;
            container.innerHTML = '<div class="col-span-full animate-pulse text-xs opacity-50">Chargement des derni√®res analyses...</div>';
            
            // Chemin Firestore : artifacts/appId/public/data/collection
            const colRef = collection(db, 'artifacts', currentAppId, 'public', 'data', col);
            
            onSnapshot(query(colRef, limit(4)), (snap) => {
                if(snap.empty) {
                    container.innerHTML = '<div class="col-span-full text-xs opacity-30 italic">Aucune analyse disponible pour le moment.</div>';
                    return;
                }
                container.innerHTML = '';
                snap.forEach(doc => {
                    const d = doc.data();
                    const card = document.createElement('div');
                    card.className = `article-bento p-6 rounded-[2rem] cursor-pointer hover:scale-[1.02] transition-transform group`;
                    card.onclick = () => window.showArticle(d, `https://source.unsplash.com/featured/?${color},tech`);
                    card.innerHTML = `
                        <div class="flex flex-col h-full">
                            <div class="text-[9px] font-black uppercase tracking-[0.2em] text-${color}-400 mb-2">Analyse Automatique</div>
                            <h4 class="text-white font-bold text-lg mb-3 line-clamp-2 group-hover:text-${color}-300 transition-colors">${d.title}</h4>
                            <p class="text-[11px] text-slate-400 line-clamp-3 mb-6">${d.meta_description || "Analyse approfondie de l'actualit√© r√©cente par notre moteur IA."}</p>
                            <div class="mt-auto flex items-center gap-2 text-[10px] font-bold text-${color}-400">
                                LIRE L'ANALYSE <i class="fas fa-arrow-right"></i>
                            </div>
                        </div>
                    `;
                    container.appendChild(card);
                });
            }, (err) => {
                container.innerHTML = '<div class="col-span-full text-xs text-red-400">Erreur de synchronisation.</div>';
            });
        }

        // --- MARKET LOGIC ---
        async function fetchMarketData() {
            try {
                const res = await fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=eur&ids=bitcoin,ethereum,solana&sparkline=true');
                const data = await res.json();
                marketData = data.reduce((acc, coin) => ({ ...acc, [coin.id]: coin }), {});
                document.getElementById('ticker-btc').innerText = `${marketData.bitcoin.current_price.toLocaleString()} ‚Ç¨`;
                data.forEach(coin => renderMiniChart(coin));
            } catch(e) {}
        }

        function renderMiniChart(coin) {
            const canvasId = `${coin.id === 'bitcoin' ? 'btc' : coin.id === 'ethereum' ? 'eth' : 'sol'}ChartMini`;
            const ctx = document.getElementById(canvasId);
            if(!ctx) return;
            if(charts[coin.id]) charts[coin.id].destroy();
            const color = coin.price_change_percentage_24h >= 0 ? '#10b981' : '#f43f5e';
            charts[coin.id] = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: coin.sparkline_in_7d.price.map((_, i) => i),
                    datasets: [{ data: coin.sparkline_in_7d.price, borderColor: color, borderWidth: 2, pointRadius: 0, fill: false, tension: 0.4 }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { legend: { display: false }, tooltip: { enabled: false } },
                    scales: { x: { display: false }, y: { display: false } }
                }
            });
        }

        // --- NAVIGATION ---
        window.switchView = (view) => {
            document.querySelectorAll('.page-view').forEach(v => v.classList.remove('active'));
            document.getElementById(`view-${view}`).classList.add('active');
            const nav = document.getElementById('main-nav');
            if(view === 'home') nav.classList.add('hidden');
            else {
                nav.classList.remove('hidden');
                document.documentElement.style.setProperty('--accent', getComputedStyle(document.body).getPropertyValue(`--${view === 'ia' ? 'ia' : view === 'finance' ? 'fi' : 'sp'}`));
                
                // Initialisation sp√©cifique par vue
                if(view === 'ia') {
                    renderGrid('ia-tools-grid', arsenalIA, 'purple');
                    loadArticles('articles', 'ia-articles-grid', 'purple');
                } else if(view === 'finance') {
                    renderGrid('fi-tools-grid', arsenalFI, 'emerald');
                    loadArticles('articles_finance', 'fi-articles-grid', 'emerald');
                    fetchMarketData();
                } else if(view === 'sport') {
                    renderGrid('sp-tools-grid', arsenalSP, 'rose');
                    loadArticles('articles_sport', 'sp-articles-grid', 'rose');
                }
            }
            window.scrollTo({ top: 0, behavior: 'smooth' });
        };

        window.toggleModal = id => document.getElementById(id).classList.toggle('hidden');
        window.showArticle = (d, img) => {
            window.toggleModal('aiModal');
            document.getElementById('modalCoverImage').src = img;
            document.getElementById('aiContent').innerHTML = marked.parse(`# ${d.title}\n\n${d.content || d.articleContent || 'Chargement...'}`);
        };

        signInAnonymously(auth);
        setInterval(() => { document.getElementById('live-time').innerText = new Date().toLocaleTimeString('fr-FR'); }, 1000);
        setInterval(fetchMarketData, 60000);
    </script>
</body>
</html>
